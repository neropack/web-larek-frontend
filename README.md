# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Интерфейс карточки товара

```
interface ICard {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
}
```

Интерфейс для модели корзины

```
interface IBasket {
    items: string[];
    price: number;
}
```

Интерфейс расширеннего API приложения для обработки входящих данных с сервера

```
interface IAppAPI {
    getCardList: () => Promise<void | ICard[]>;
    orderCards: (order: IOrder) => Promise<IOrderResult>;
}
```

Интерфейс составления валидного заказа

```
interface IOrder {
    payment: PaymentMethod;
    address: string;
    email: string;
    phone: string;
    items: string[];
    total: number;
}
```

Интерфейс содержащий индентификатор созданного заказа и количества списанной суммы

```
interface IOrderResult {
    id: string;
    total: number;
}
```

Интерфейсы описывающие события для модальных окон добавления карточки в корзину и результата заказа

```
interface ICardAction {
    onClick: (event: MouseEvent) => void;
}

interface ISuccessAction {
    onClick: (event: MouseEvent) => void;
}
```

Тип данных метода оплаты

```
type PaymentMethod = 'cash' | 'card';
```

Тип для валидации полей ввода

```
type OrderForm = Omit<IOrder, 'total' | 'items'>;
```

### Интерфейсы для отображения моделей данных

Интерфейс отображения модальных окон

```
interface IModalData {
    content: HTMLElement;
}
```

Интерфейс содержащий поля для отслеживания валидности введенных пользователем данных.

```
interface IForm {
    valid: boolean;
    errors: string[];
}
```

Интерфейс для отображения каталога карточек и количества товаров в корзине

```
interface IPage {
    basketCounter: number;
    catalog: HTMLElement[];
}
```

## Базовые классы

### Класс `Component`
Абстрактный класс который является базовым компонентом и служит основой для создания различных компонентов представления. Предоставляет ряд методов для работы с DOM элементами.<br> Конструктор принимает один параметр - контейнер типа HTMLElement, в котором компонент будет рендериться.
Методы:
- `setText(element: HTMLElement, value: unknown)` - Устанавливает текстовое содержимое элемента.
- `setImage(element: HTMLImageElement, src: string, alt?: string)` - Устанавливает изображение и альтернативный текст.
- `render(data?: Partial<T>): HTMLElement` - Основной метод, который возвращает корневой DOM-элемент компонента.
Принимает необязательный параметр `data`, который можно использовать для обновления свойств компонента.

### Класс `View`
Класс наследуется от `Component` и добавляет поле `events` типа `IEvents`, которое используется для управления событиями компонента.
Конструктор принимает два параметра:`container` и `events`.

### Класс `EventEmitter`
Обеспечивает работу событий. Его функции: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события.

Реализует интерфейс `IEvents`. В параметры конструктора класса ничего не передается. В конструкторе создает структуру данных для управления событиями и их подписчиками.

Содержит:

- `_events: Map<EventName, Set<Subscriber>>;` - переменная в которую будут кэшироваться события.
- `on<T extends object>(eventName: EventName, callback: (event: T) => void)` - функция установки обработчика на событие.
- `off(eventName: EventName, callback: Subscriber)` - функция снятия обработчика с события.
- `emit<T extends object>(eventName: string, data?: T)` - функция инициирования события с данными.
- `onAll(callback: (event: EmitterEvent) => void)` - функция прослушивания всех событий.
- `offAll()` - функция сброса всех обработчиков.
- ` trigger<T extends object>(eventName: string, context?: Partial<T>)` - функция создающая коллбек триггер, генерирующий событие при вызове.

## Модели данных

### Класс `AppAPI`
Наследуется от класса `Api`. Взаимодействует с веб-API для работы с продуктами и заказами. В конструктор передается базовый адрес сервера, адрес хоста cdn для контента и опциональный объект с заголовками запросов. В конструкторе вызывается конструктор родительского класса Api с переданными параметрами и присваивание полю `cdn`.
Содержит: 
- `readonly cdn: string;` - Поле в которое записывается cdn.
- `getCardList(): Promise<ICard[]>` - Выполняет запрос для получения списка продуктов и обрабатывает полученные данные, добавляя к каждому элементу ссылку на изображение.
- `orderCards(order: IOrder): Promise<IOrderResult>` - Выполняет запрос на оформление заказа и возвращает результат оформления.

### Класс `AppData`
Класс представляет хранилище данных приложения. Он содержит информацию о предпросмотре товара, карточках, заказе и ошибках формы заказа. Класс также обеспечивает методы для управления этими данными и взаимодействия с ними через события.
Конструктор класса принимает объект событий `events`.

Содержит:
- `preview: ICard` - Содержит карточку, переданную для отображения в модальном окне.
- `catalog: ICard[]` - Массив содержащий весь товар.
- `order: IOrder` - Содержит информацию вводимую клиентом.
- `formErrors: Partial<Record<keyof OrderForm, string>>` - Содержит ошибки при заполнении форм.
- `setItems(items: ICard[])` - Метод устанавливает список продуктов и генерирует событие изменения списка.
- `setModal(item: ICard)` - Метод устанавливает предпросмотр товара и генерирует событие изменения предпросмотра.
- `inBasket(item: ICard)` - Метод проверяет, содержится ли товар в корзине.
- `addToBasket(item: ICard)` - Метод добавляет товар в корзину и генерирует событие изменения корзины.
- `removeFromBasket(item: ICard)` - Метод удаляет товар из корзины и генерирует событие изменения корзины.
- `setPaymentMethod(method: PaymentMethod)` - Метод устанавливает метод оплаты для заказа.
- `setOrderField(field: keyof OrderForm, value: string)` - Метод устанавливает значения полей заказа и проверяет их валидность.
- `validateOrder()` - Метод проверяет валидность заказа и генерирует событие изменения ошибок формы заказа.
- `clearBasket()` - Метод очищает корзину и генерирует событие изменения корзины.
- `getTotalPrice()` - Метод подсчёт общей стоимости корзины.

## Компоненты представления

### Класс `Page`
Наследуется от класса `View\<IPage>`. Представляет компонент страницы с некоторыми элементами и функциональностью для управления ими.
Конструктор класса принимает контейнер страницы `container` типа `HTMLElement` и объект событий `events` типа `IEvents`.
В конструкторе вызывается конструктор родительского класса `View` с переданным контейнером и объектом событий, полям присваиются ссылки элементов и на кнопку открывание корзины добавляется слушатель нажатия.

Содержит:
- `basketCounter: HTMLElement` - Приватное поле для хранения ссылки на счётчик количества товара в корзине.
- `catalog: HTMLElement` - Приватное поле для хранения ссылки на контейнер карточек товара
- `basket: HTMLElement` - Приватное поле для хранения ссылки на иконку корзины
- `wrapper: HTMLElement` - Приватное поле для хранения ссылки на обёртку страницы
- `catalog(items: HTMLElement[])` - Сеттер для установки содержимого каталога.
- `locked(value: boolean)` - Сеттер блокировки скролла страницы при открытом модальном окне.
- `counter(value: number)` - Сеттер для отображения количества товара в корзине.

### Класс `Card`
Наследуется от класса `Component\<ICard>`.Отвечает за отображение карточки и её информации. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. Конструктор класса принимает контейнер карточки `container` типа `HTMLElement` и опциональные действия `actions` типа `ICardActions`. В конструкторе вызывается конструктор родительского класса `Component` с переданным контейнером, полям присваиваются ссылки элементов и добавляется слушатель.
Содержит:
- `title: HTMLElement` - Приватное поле для хранения ссылки на элемент заголовока карточки.
- `image: HTMLImageElement` - Приватное поле для хранения ссылки на изображение карточки.
- `category: HTMLElement` - Приватное поле для хранения ссылки на элемент категории карточки.
- `price: HTMLElement` - Приватное поле для хранения ссылки на элемент цены карточки.
- `button: HTMLButtonElement` - Приватное поле для хранения ссылки на элемент кнопки карточки.
- `description: HTMLElement` - Приватное поле для хранения ссылки на элемент описание карточки.
- `categoryColor = new Map<string, string>` - Приватное поле для хранения массива с категориями.
- `id(value: string)` - Сеттер присваивания id.
- `title(value:string)` - Сеттер присваивания заголовка карточки.
- `image(value:string` - Сеттер присваивания картинки товара
- `category(value:string)` - Сеттер присваивания категории товара и соответсвующего стиля
- `price(value: string)` - Сеттер присваивания цены товара
- `button(value: string)` - Сеттер изменения текста внутри кнопки

### Класс `Modal`
Наследуется от класса `View\<IModalData>`. Представляет компонент модального окна с возможностью открытия и закрытия, а также управления содержимым.
Конструктор класса принимает контейнер модального окна `container` типа `HTMLElement` и объект событий `events` типа `IEvents`. В конструкторе вызывается конструктор родительского класса `View` с переданным контейнером и объектом событий, полям присваиваются ссылки элементов и добавляются слушатели закрытия модального окна.

Содержит:
- `closeButton: HTMLButtonElement` - Приватное поле для хранения ссылки на элемент кнопки закрытия окна.
- `content: HTMLElement` - Приватное поле для хранения ссылки на элемент контейнера для контента модального окна.
- `content(value: HTMLElement)` - Сеттер устанавливает новое содержимое модального окна, заменяя предыдущее содержимое.
- `handleMouseUp(event: MouseEvent)` - Метод обработки события закрытия модального окна при клике вне контейнера.
- `open()` - Метод открывает модальное окно, добавляя ему класс `modal_active`, и генерирует событие `'modal:open'`.
- `close()` - Метод закрывает модальное окно, удаляя класс `modal_active`, устанавливает содержимое модального окна в `null` и генерирует событие `'modal:close'`.

### Класс `Basket`
Наследуется от класса `View\<IBasket>`. Представляет компонент корзины с возможностью отображения списка товаров,<br> общей суммы и управления состоянием кнопки оформления заказа.\
Конструктор класса, который принимает контейнер корзины `container` типа `HTMLElement` и объект events типа `EventEmitter` для управления событиями. Внутри конструктора вызывается конструктор родительского класса View с клонированным HTML-шаблоном корзины, присваиваются ссылки полям и добавляются слушатель на кнопку.

Содержит:
- `list: HTMLElement` - Приватное поле для хранения ссылки на элемент корзины.
- `price: HTMLElement` - Приватное поле для хранения ссылки на элемент корзины и установки цены.
- `button: HTMLButtonElement` - Приватное поле для хранения ссылки на элемент корзины.
- `items(items: HTMLElement[])` - Сеттер для установки списка товаров в корзине. Если список не пустой, элементы списка заменяются внутри контейнера корзины. Если список пуст, вставляется элемент "Корзина пуста". Также обновляется состояние кнопки оформления заказа.
- `price(price: number)` - Сеттер установки общей суммы товаров в корзине
- `refreshIndex()` - Метод для обновления нумерации добавленных товаров в корзину.

### Класс `Form`

Наследуется от класса `View\<IFormState>`. Представляет компонент формы с возможностью управления состоянием валидации и отображения ошибок. Конструктор класса принимает контейнер формы `container` типа `HTMLFormElement` и объект событий `events` типа `EventEmitter`. В конструкторе вызывается конструктор родительского класса `View` с переданным контейнером и объектом событий, присваиваются ссылки полям класса и добавляется слушатели.

Содержит:
- `submit: HTMLButtonElement` - Приватное поле для хранения ссылки на элемент кнопки отправки формы.
- `errors: HTMLElement` - Приватное поле для хранения ссылки на элемент отображения ошибки.
- `onInputChange(field: keyof T, value: string)` - Метод генерирует событие `change` с данными о поле формы, которое было изменено, и его значении.
- `valid(value: boolean)` - Сеттер установка состояния валидации формы
- `errors(value: string)` - Сеттер для отображение ошибок.
- `render(state: Partial<T> & IForm)` - Метод принимает объект `state`, который содержит частичное состояние формы, обновляет состояние компонента и возвращает контейнер.

### Класс `Order`
Наследуется от класса `Form\<OrderForm>`. Представляет форму заказа с возможностью выбора способа оплаты.
Конструктор класса, который принимает контейнер формы заказа `container` типа `HTMLFormElement` и объект событий `events` типа `EventEmitter`. В конструкторе вызывается конструктор родительского класса `Form` с переданным контейнером и объектом событий, присваиваются ссылки полям класса и добавляется слушатели.

Содержит:
- `_paymentCard` и `_paymentCash` - Приватные поля для хранения ссылок на элементы кнопок выбора варианта оплаты.
- `payment(value: PaymentMethod)` - Сеттер устанавливает выбранный метод оплаты и активирует соответствующую кнопку.
- `address(value: string)` - Сеттер устанавливает адрес для доставки заказа.

### Класс `Contacts`
Наследуется от класса `Form\<OrderForm>`. Представляет форму для ввода контактной информации (электронной почты и номера телефона) при оформлении заказа.
Конструктор класса, который принимает контейнер формы контактной информации `container` типа `HTMLFormElement` и объект событий `events` типа `EventEmitter`. В конструкторе вызывается конструктор родительского класса `Form` с переданным контейнером и объектом событий.

Содержит:
- `email(value: string)` - Сеттер устанавливает значение электронной почты в соответствующем поле формы.
- `phopne(value: string)` - Сеттер устанавливает значение номера телефона в соответствующем поле формы.

### Класс `Success`
Наследуется от класса `Component\<IOrderResult>`. Представляет компонент для отображения сообщения об успешном оформлении заказа.
Конструктор класса, который принимает контейнер элемента `container` типа `HTMLFormElement` и опциональные действия `actions` типа `ISuccessActions`. В конструкторе вызывается конструктор родительского класса `Component` с переданным контейнером, присваиваются ссылки полям класса и добавляется слушатели.

Содержит:
- `total: HTMLElement` - Приватное поле для хранения ссылки на элемент разметки страницы с общей суммой заказа.
- `close: HTMLButtonElement` - Приватное поле для хранения ссылки на элемент кнопки закрытия модального окна.
- `total(value: number)` - Устанавливает значение общей суммы заказа.

## Описание событий

*Список всех событий, которые могут генерироваться в системе:*\
*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `items:change` - Вызывается при изменении списка товаров.
- `card:select` - Вызывается при нажатии на карточку товара.
- `preview:change` - Вызывается при изменении предварительного просмотра товара.
- `modal:open` - Вызывается при открытии модального окна.
- `modal:close` - Вызывается при закрытии модального окна.
- `basket:open` - Вызывается при открытии корзины.
- `basket:change` - Вызывается при изменении содержимого корзины.
- `order:open` - Вызывается при открытии оформления заказа.
- `formErrors:change` - Вызывается при изменении ошибок в форме.
- `order.\*:change` - При срабатывании события вызывается функция, которая устанавливает новое значение для указанного поля в форме оформления заказа.
- `order:submit` - Вызывается при нажатии кнопки продолжения заполнения заказа.
- `contacts.\*:change` - При срабатывании события вызывается функция, которая устанавливает новое значение для указанного поля в форме оформления заказа.
- `contacts:submit` - Вызывается при отправке контактной информации.
